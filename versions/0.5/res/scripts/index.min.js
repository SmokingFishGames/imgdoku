function submitImgurURL(e){var t=$("#imgurinput").val();t=parseImgurURL(t),""==t||5!=t.length?e?window.location="game.html?o=i&h="+t+"&d="+getDiff():$("#imgurMalformedError").modal({overlayClose:!0}):window.location="/game.html?o=i&h="+t+"&d="+getDiff()}function submitFB(){1==selectedFB.empty?$("#fbUnselectedError").modal({overlayClose:!0}):window.location="/game.html?o=fb&h="+selectedFB.albumID+"&d="+getDiff()}function playNow(){$.get("/_static/pn/pnh.txt",function(e){window.location="/game.html?o=i&h="+e+"&d="+getDiff()+"&pn=1"}).error(function(){window.location="/game.html?o=i&h=6EsqA&d="+getDiff()+"&pn=1"})}function getDiff(){return $.cookie("diff",$("input[name=difficulty]:checked","#mainForm").val(),{expires:999,path:"/"}),$("input[name=difficulty]:checked","#mainForm").val()}function getOrigin(){return $("input[name=origin]:checked","#mainForm").val()}function finishFBLogin(){FB.getLoginStatus(function(e){"connected"==e.status&&initFBAlbums()})}function initFBAlbums(){$("#fbfriendmenu").append('<option value="me">Me</option>'),FB.api("/me/friends",function(e){for(i in e.data)FB.api("/"+e.data[i].id+"/albums",function(e){if(e.data.length>0){var t=!1;for(i in e.data)if(e.data[i].count>=9){t=!0;break}t&&$("#fbfriendmenu").append('<option value="'+e.data[0].from.id+'">'+e.data[0].from.name+"</option>")}})}),fetchFBAlbums("me"),$("#fbfriendmenu").css("display","inline"),$("#fbfriendselect").css("display","inline")}function selectFriend(){var e=$("#fbfriendmenu").val();fetchFBAlbums(e)}function fetchFBAlbums(e){FB.api("/"+e+"/albums",function(t){if(0==t.data.length)"me"==e?$("#fbalbums").text("You don't have any albums available to this app.  Try selecting a friend."):FB.api("/"+e,function(e){$("#fbalbums").text(e.name+" doesn't have any albums available to this app.  Try selecting a different friend.")});else{$("#fbalbums").html("");var n=!1;for(i in t.data)t.data[i].count>=9&&(n=!0,"app"!=t.data[i].type&&($("#fbalbums").append('<div class="albumThumbHolder" id="'+t.data[i].cover_photo+'ath"><img id="'+t.data[i].cover_photo+'" class="fbalbumthumb" onclick="selectFBImg(\''+(t.data[i].id+"")+"','"+(t.data[i].cover_photo+"")+'\');" title="'+t.data[i].name+'" /><a href="'+t.data[i].link+'" target="_blank" class="albumLink">View Album</a></div>'),FB.api(t.data[i].cover_photo,function(e){for(i in e.images)if(200>e.images[i].height||200>e.images[i].width){$("#"+e.id).attr("src",e.images[i].source);break}})));n||("me"==e?$("#fbalbums").text("You don't have any albums with enough images."):FB.api("/"+e,function(e){$("#fbalbums").text(e.name+" doesn't have any albums with enough images.")}))}$(".fbalbumthumb").powerTip({followMouse:!0,smartPlacement:!0})})}function selectFBImg(e,t){1==selectedFB.empty||($("#"+selectedFB.coverID+"ath").css("border","0px"),$("#"+selectedFB.coverID+"ath").css("margin","5px")),selectedFB.albumID=e,selectedFB.coverID=t,selectedFB.empty=!1,$("#"+selectedFB.coverID+"ath").css("border","5px solid #91FDFF"),$("#"+selectedFB.coverID+"ath").css("margin","0px")}function openModal(){$("#uploadHolder").modal({overlayClose:!0,onClose:function(){closeModal()},onShow:function(){$("#simplemodal-container").css("height","auto"),$("#simplemodal-container").css("width","auto")},autoResize:!0}),document.getElementById("infile").addEventListener("change",inputLocal,!1),$.ajax({url:"https://api.imgur.com/3/album/",type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){upDeleteHash=e.data.deletehash,upHash=e.data.id,$("#albumLink").html('<a href="http://imgur.com/a/'+upHash+'" target="_blank">Any images will be publicly available at this address.</a>')},error:function(e){console.log(e)}})}function closeModal(){$.modal.close(),deleteAlbum(),uploadedImgs=[],currUploading=0,$("#infile").prop("disabled",!1),$("#inurl").prop("disabled",!1),$("#inurlButton").prop("disabled",!1),$("#submitUpload").prop("disabled",!0)}function imgurImg(e,t,i){this.ID=e,this.link=t,this.deletehash=i}function uploadImgur(e){9>uploadedImgs.length+currUploading&&(currUploading++,$("#upProgress").css("display","inline"),$.ajax({url:"https://api.imgur.com/3/image/",type:"POST",data:{image:e,album:upDeleteHash},dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){var t=new imgurImg(e.data.id,e.data.link,e.data.deletehash);uploadedImgs.push(t),currUploading--,drawImages(),9==uploadedImgs.length&&($("#infile").prop("disabled",!0),$("#inurl").prop("disabled",!0),$("#inurlButton").prop("disabled",!0),$("#submitUpload").prop("disabled",!1)),0==currUploading&&$("#upProgress").css("display","none")},error:function(e){currUploading--,0==currUploading&&$("#upProgress").css("display","none");var t=$.parseJSON(e.responseText);uploadErrorQueue.push(t.data.error),processErrorQueue()}}))}function processErrorQueue(){uploadErrorDisp||(uploadErrorQueue.length>0?($("#uploadErrorText").fadeOut(function(){$(this).text(uploadErrorQueue.shift()).fadeIn()}),uploadErrorDisp=!0,uploadErrorTimeout=window.setTimeout(function(){uploadErrorDisp=!1,processErrorQueue()},3e3)):$("#uploadErrorText").fadeOut())}function submitImages(){var e=[];for(i=0;9>i;i++)e[i]=uploadedImgs[i].ID}function drawImages(){$("#imgDisp").html("");var e="";e+='<table class="imgDispTable">';for(i in uploadedImgs)0==i%3&&(e+="<tr>"),e+='<td class="thumbHolder"><img class="thumb" src="'+uploadedImgs[i].link+'" /><img src="/res/img/cancel1.png" class="deleteImg" onclick="deleteImg(\''+uploadedImgs[i].ID+"');\" /></td>",2==i%2&&(e+="</tr>");e+="</table>",$("#imgDisp").html(e)}function deleteImg(e){for(i in uploadedImgs)if(uploadedImgs[i].ID==e){$.ajax({url:"https://api.imgur.com/3/image/"+uploadedImgs[i].deletehash,type:"DELETE",dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}}),uploadedImgs.splice(i,1),$("#infile").prop("disabled",!1),$("#inurl").prop("disabled",!1),$("#inurlButton").prop("disabled",!1),$("#submitUpload").prop("disabled",!0);break}drawImages()}function deleteAlbum(){for(i in uploadedImgs)$.ajax({url:"https://api.imgur.com/3/image/"+uploadedImgs[i].deletehash,type:"DELETE",dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}});$.ajax({url:"https://api.imgur.com/3/album/"+upDeleteHash,type:"DELETE",dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function inputLocal(e){for(var t,i=e.target.files,n=0;t=i[n];n++)if(t.type.match("image.*")){var s=new FileReader;s.onload=function(e){var t=e.target.result;t=t.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""),uploadImgur(t)},s.readAsDataURL(t)}$("#infile").val("")}function inputExternal(){var e=$("#inurl").val();uploadImgur(e),$("#inurl").val("")}function submitAlbum(){upHist.push(upHash);var e=JSON.stringify(upHist);$.cookie("userUpped",e,{expires:999,path:"/"}),window.location="game.html?o=i&h="+upHash+"&d="+getDiff()}function submitUpHist(){1==selectedUpHist.empty?$("#imgurUnselectedError").modal({overlayClose:!0}):window.location="game.html?o=i&h="+selectedUpHist.ID+"&d="+getDiff()}function selectUpHist(e){1==selectedUpHist.empty||($("#"+selectedUpHist.ID).css("border","0px"),$("#"+selectedUpHist.ID).css("margin","5px")),selectedUpHist.ID=e,selectedUpHist.empty=!1,$("#"+selectedUpHist.ID).css("border","5px solid #91FDFF"),$("#"+selectedUpHist.ID).css("margin","0px")}function deleteUpHist(e){for(var t in upHist)if(upHist[t]==e){upHist.splice(t,1),$("#"+e).css("display","none");var i=JSON.stringify(upHist);$.cookie("userUpped",i,{expires:999,path:"/"});break}}var fbalbums,selectedFB={empty:!0},selectedUpHist={empty:!0};$(document).ready(function(e,t,i){var n,s=e.getElementsByTagName(t)[0];e.getElementById(i)||(n=e.createElement(t),n.id=i,n.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=154174584743698",s.parentNode.insertBefore(n,s))}(document,"script","facebook-jssdk")),window.fbAsyncInit=function(){FB.getLoginStatus(function(e){"connected"===e.status?initFBAlbums():"not_authorized"===e.status?$("#fbalbums").text("You need to log in."):$("#fbalbums").text("You need to log in.")})};var imgurClientID="60512304ac2e7ce",uploadedImgs=[],currUploading=0,upDeleteHash,upHash,upHist=[],uploadErrorQueue=[],uploadErrorDisp=!1;$(document).ready(function(){if($("input[name=difficulty]:eq("+(Number($.cookie("diff"))-1)+")","#mainForm").attr("checked","checked"),$.cookie("userUpped")!==void 0){var e=$.cookie("userUpped");e=$.parseJSON(e),upHist="string"==typeof e?[e]:e;for(i in upHist)$.ajax({url:"https://api.imgur.com/3/album/"+upHist[i],type:"GET",dataType:"json",cache:!1,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){var t=e.data.cover;t+="t",t="http://i.imgur.com/"+t+".jpg",$("#createdPalettes").prepend('<div class="albumThumbHolder" id="'+e.data.id+'"><img class="imguralbumthumb" onclick="selectUpHist(\''+e.data.id+'\');" title="'+e.data.id+'" src="'+t+'" /><img src="/res/img/cancel1.png" class="deleteImg" onclick="deleteUpHist(\''+e.data.id+'\');"><a class="albumLink" target="_blank" href="'+e.data.link+'">View Album</a></div>'),$(".imguralbumthumb").powerTip({followMouse:!0,smartPlacement:!0})},error:function(e){console.log(e)}});0==upHist.length&&$("#createdPalettes").text("You haven't created any albums yet.")}else $("#createdPalettes").text("You haven't created any albums yet.");$(".indexButton").powerTip({placement:"se",smartPlacement:!0}),$("#imgurinput").keyup(function(e){13==e.keyCode&&submitImgurURL(!1)})});