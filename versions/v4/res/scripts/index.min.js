function submitImgurURL(e){var t=$("#imgurinput").val();t=parseImgurURL(t);if(t==""||t.length!=5){if(e){window.location="game.html?o=i&h="+t+"&d="+getDiff()}else{$("#imgurMalformedError").modal({overlayClose:true})}}else{window.location="/game.html?o=i&h="+t+"&d="+getDiff()}}function parseImgurURL(e){if(e.length==5){}else{var t=e.split("a/");e=t[t.length-1];e=e.split("#")[0];e=e.split("/")[0]}return e}function submitFB(){if(selectedFB.empty==true){$("#fbUnselectedError").modal({overlayClose:true})}else{window.location="/game.html?o=fb&h="+selectedFB.albumID+"&d="+getDiff()}}function playNow(){$.get("/_static/pn/pnh.txt",function(e){window.location="/game.html?o=i&h="+e+"&d="+getDiff()+"&pn=1"}).error(function(){window.location="/game.html?o=i&h=6EsqA&d="+getDiff()+"&pn=1"})}function getDiff(){$.cookie("diff",$("input[name=difficulty]:checked","#mainForm").val(),{expires:999,path:"/"});return $("input[name=difficulty]:checked","#mainForm").val()}function getOrigin(){return $("input[name=origin]:checked","#mainForm").val()}function finishFBLogin(){FB.getLoginStatus(function(e){if(e.status=="connected"){initFBAlbums()}})}function submitCustom(){var e=getOrigin();switch(e){case"fb":submitFB();break;case"i":submitImgurURL();break}}function initFBAlbums(){$("#fbfriendmenu").append('<option value="me">'+"Me"+"</option>");FB.api("/me/friends",function(e){for(i in e.data){FB.api("/"+e.data[i].id+"/albums",function(e){if(e.data.length>0){var t=false;for(i in e.data){if(e.data[i].count>=9){t=true;break}}if(t)$("#fbfriendmenu").append('<option value="'+e.data[0].from.id+'">'+e.data[0].from.name+"</option>")}})}});fetchFBAlbums("me");$("#fbfriendmenu").css("display","inline");$("#fbfriendselect").css("display","inline")}function selectFriend(){var e=$("#fbfriendmenu").val();fetchFBAlbums(e)}function fetchFBAlbums(e){FB.api("/"+e+"/albums",function(t){if(t.data.length==0){if(e=="me"){$("#fbalbums").text("You don't have any albums available to this app.  Try selecting a friend.")}else{FB.api("/"+e,function(e){$("#fbalbums").text(e.name+" doesn't have any albums available to this app.  Try selecting a different friend.")})}}else{$("#fbalbums").html("");var n=false;for(i in t.data){if(t.data[i].count>=9){n=true;if(t.data[i].type!="app"){$("#fbalbums").append('<div class="albumThumbHolder" id="'+t.data[i].cover_photo+'ath"><img id="'+t.data[i].cover_photo+'" class="fbalbumthumb" onclick="selectFBImg(\''+String(t.data[i].id)+"','"+String(t.data[i].cover_photo)+'\');" title="'+t.data[i].name+'" /><a href="'+t.data[i].link+'" target="_blank" class="albumLink">View Album</a></div>');FB.api(t.data[i].cover_photo,function(e){for(i in e.images){if(e.images[i].height<200||e.images[i].width<200){$("#"+e.id).attr("src",e.images[i].source);break}}})}}}if(!n){if(e=="me"){$("#fbalbums").text("You don't have any albums with enough images.")}else{FB.api("/"+e,function(e){$("#fbalbums").text(e.name+" doesn't have any albums with enough images.")})}}}$(".fbalbumthumb").powerTip({followMouse:true,smartPlacement:true})})}function selectFBImg(e,t){if(selectedFB.empty==true){}else{$("#"+selectedFB.coverID+"ath").css("border","0px");$("#"+selectedFB.coverID+"ath").css("margin","5px")}selectedFB.albumID=e;selectedFB.coverID=t;selectedFB.empty=false;$("#"+selectedFB.coverID+"ath").css("border","5px solid #91FDFF");$("#"+selectedFB.coverID+"ath").css("margin","0px")}function openModal(){$("#uploadHolder").modal({overlayClose:true,onClose:function(){closeModal()},onShow:function(){$("#simplemodal-container").css("height","auto");$("#simplemodal-container").css("width","auto")},autoResize:true});document.getElementById("infile").addEventListener("change",inputLocal,false);$.ajax({url:"https://api.imgur.com/3/album/",type:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){upDeleteHash=e.data.deletehash;upHash=e.data.id;$("#albumLink").html('<a href="http://imgur.com/a/'+upHash+'" target="_blank">Any images will be publicly available at this address.</a>')},error:function(e){console.log(e)}})}function closeModal(){$.modal.close();deleteAlbum();uploadedImgs=[];currUploading=0;upDeleteHash;upHash;$("#infile").prop("disabled",false);$("#inurl").prop("disabled",false);$("#inurlButton").prop("disabled",false);$("#submitUpload").prop("disabled",true)}function imgurImg(e,t,n){this.ID=e;this.link=t;this.deletehash=n}function uploadImgur(e){if(uploadedImgs.length+currUploading<9){currUploading++;$("#upProgress").css("display","inline");$.ajax({url:"https://api.imgur.com/3/image/",type:"POST",data:{image:e,album:upDeleteHash},dataType:"json",cache:false,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){var t=new imgurImg(e.data.id,e.data.link,e.data.deletehash);uploadedImgs.push(t);currUploading--;drawImages();if(uploadedImgs.length==9){$("#infile").prop("disabled",true);$("#inurl").prop("disabled",true);$("#inurlButton").prop("disabled",true);$("#submitUpload").prop("disabled",false)}if(currUploading==0){$("#upProgress").css("display","none")}},error:function(e){currUploading--;if(currUploading==0){$("#upProgress").css("display","none")}}})}}function submitImages(){var e=[];for(i=0;i<9;i++){e[i]=uploadedImgs[i].ID}}function drawImages(){$("#imgDisp").html("");var e="";e+='<table class="imgDispTable">';for(i in uploadedImgs){if(i%3==0)e+="<tr>";e+='<td class="thumbHolder"><img class="thumb" src="'+uploadedImgs[i].link+'" /><img src="/res/img/cancel1.png" class="deleteImg" onclick="deleteImg(\''+uploadedImgs[i].ID+"');\" /></td>";if(i%2==2)e+="</tr>"}e+="</table>";$("#imgDisp").html(e)}function deleteImg(e){for(i in uploadedImgs){if(uploadedImgs[i].ID==e){$.ajax({url:"https://api.imgur.com/3/image/"+uploadedImgs[i].deletehash,type:"DELETE",dataType:"json",cache:false,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}});uploadedImgs.splice(i,1);$("#infile").prop("disabled",false);$("#inurl").prop("disabled",false);$("#inurlButton").prop("disabled",false);$("#submitUpload").prop("disabled",true);break}}drawImages()}function deleteAlbum(){for(i in uploadedImgs){$.ajax({url:"https://api.imgur.com/3/image/"+uploadedImgs[i].deletehash,type:"DELETE",dataType:"json",cache:false,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}})}$.ajax({url:"https://api.imgur.com/3/album/"+upDeleteHash,type:"DELETE",dataType:"json",cache:false,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){console.log(e)},error:function(e){console.log(e)}})}function inputLocal(e){var t=e.target.files;for(var n=0,r;r=t[n];n++){if(!r.type.match("image.*")){continue}var i=new FileReader;i.onload=function(e){var t=e.target.result;t=t.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,"");uploadImgur(t)};i.readAsDataURL(r)}$("#infile").val("")}function inputExternal(){var e=$("#inurl").val();uploadImgur(e);$("#inurl").val("")}function submitAlbum(){upHist.push(upHash);var e=JSON.stringify(upHist);$.cookie("userUpped",e,{expires:999,path:"/"});window.location="game.html?o=i&h="+upHash+"&d="+getDiff()}function submitUpHist(){if(selectedUpHist.empty==true){$("#imgurUnselectedError").modal({overlayClose:true})}else{window.location="game.html?o=i&h="+selectedUpHist.ID+"&d="+getDiff()}}function selectUpHist(e){if(selectedUpHist.empty==true){}else{$("#"+selectedUpHist.ID).css("border","0px");$("#"+selectedUpHist.ID).css("margin","5px")}selectedUpHist.ID=e;selectedUpHist.empty=false;$("#"+selectedUpHist.ID).css("border","5px solid #91FDFF");$("#"+selectedUpHist.ID).css("margin","0px")}function deleteUpHist(e){for(var t in upHist){if(upHist[t]==e){upHist.splice(t,1);$("#"+e).css("display","none");var n=JSON.stringify(upHist);$.cookie("userUpped",n,{expires:999,path:"/"});break}}}var fbalbums;var selectedFB={empty:true};var selectedUpHist={empty:true};$(document).ready(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n))return;r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=154174584743698";i.parentNode.insertBefore(r,i)}(document,"script","facebook-jssdk"));window.fbAsyncInit=function(){FB.getLoginStatus(function(e){if(e.status==="connected"){initFBAlbums()}else if(e.status==="not_authorized"){$("#fbalbums").text("You need to log in.")}else{$("#fbalbums").text("You need to log in.")}})};var imgurClientID="60512304ac2e7ce";var uploadedImgs=[];var currUploading=0;var upDeleteHash;var upHash;var upHist=[];$(document).ready(function(){if(typeof ($.cookie("diff")!="undefined")){$("input[name=difficulty]:eq("+(Number($.cookie("diff"))-1)+")","#mainForm").attr("checked","checked")}if(typeof $.cookie("userUpped")!="undefined"){var e=$.cookie("userUpped");e=$.parseJSON(e);if(typeof e=="string"){upHist=[e]}else{upHist=e}for(i in upHist){$.ajax({url:"https://api.imgur.com/3/album/"+upHist[i],type:"GET",dataType:"json",cache:false,beforeSend:function(e){e.setRequestHeader("Authorization","Client-ID "+imgurClientID)},success:function(e){var t=e.data.cover;t+="t";t="http://i.imgur.com/"+t+".jpg";$("#createdPalettes").prepend('<div class="albumThumbHolder" id="'+e.data.id+'"><img class="imguralbumthumb" onclick="selectUpHist(\''+e.data.id+'\');" title="'+e.data.id+'" src="'+t+'" /><img src="/res/img/cancel1.png" class="deleteImg" onclick="deleteUpHist(\''+e.data.id+'\');"><a class="albumLink" target="_blank" href="'+e.data.link+'">View Album</a></div>')},error:function(e){console.log(e)}})}if(upHist.length==0){$("#createdPalettes").text("You haven't made any image sets yet.")}}else{$("#createdPalettes").text("You haven't made any image sets yet.")}$(".indexButton").powerTip({placement:"se",smartPlacement:true})})